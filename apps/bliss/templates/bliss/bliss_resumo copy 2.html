{% extends 'intranet/intranet_base.html' %}
{% load humanize %}
{% load custom_filters %}
{% block title %}Resumo de Situações{% endblock %}

{% block content %}
{% include 'bliss/bliss_navbar.html' %}
<div class="mx-3">
  <h3 class="mb-4">Resumo por Situação</h3>
  <a href="{% url 'bliss_resumo_pdf' %}" class="btn btn-sm btn-danger mb-3" target="_blank" rel="noopener">Exportar PDF</a>

  {# ====== DESKTOP/TABLET: Tabela ====== #}
  <div class="d-none d-md-block">
    <table class="table table-bordered table-sm">
      <thead class="table-light">
        <tr>
          <th class="ps-2">Situação</th>
          <th class="text-end">Total Valor Tabela</th>
          <th class="text-end">% Valor Tabela</th>
          <th class="text-end">Total Unidades</th>
          <th class="text-end pe-2">% Unidades</th>
        </tr>
      </thead>
      <tbody>
        {% for nome, dados in situacao.items %}
        {% if not forloop.last %}
        <tr>
          <td class="ps-2">{{ nome }}</td>
          <td class="text-end">{{ dados.valor|format_real }}</td>
          <td class="text-end">{{ dados.valor_perc|floatformat:2 }}%</td>
          <td class="text-end">{{ dados.qtde }}</td>
          <td class="text-end pe-2">{{ dados.qtde_perc|floatformat:2 }}%</td>
        </tr>
        {% endif %}
        {% endfor %}
        <tr class="fw-bold table-light">
          <td class="ps-2">Total Geral</td>
          <td class="text-end">{{ situacao.Total.valor|format_real }}</td>
          <td class="text-end">{{ situacao.Total.valor_perc|floatformat:2 }}%</td>
          <td class="text-end">{{ situacao.Total.qtde }}</td>
          <td class="text-end pe-2">{{ situacao.Total.qtde_perc|floatformat:2 }}%</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

{# ====== CELULAR: Cartões/Lista ====== #}
<div class="d-block d-md-none">
  <div class="list-group mb-2">
    {% for nome, dados in situacao.items %}
    {% if not forloop.last %}
    <div class="list-group-item">
      <div class="d-flex justify-content-between">
        <strong>{{ nome }}</strong>
      </div>

      <div class="mt-2 small">
        <div class="d-flex justify-content-between">
          <span class="text-muted">Total Valor Tabela</span>
          <span class="fw-semibold">{{ dados.valor|format_real }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <span class="text-muted">% Valor Tabela</span>
          <span>{{ dados.valor_perc|floatformat:2 }}%</span>
        </div>
        <div class="d-flex justify-content-between">
          <span class="text-muted">Total Unidades</span>
          <span>{{ dados.qtde }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <span class="text-muted">% Unidades</span>
          <span>{{ dados.valor_perc|floatformat:2 }}%</span>
        </div>
      </div>
    </div>
    {% endif %}
    {% empty %}
    <div class="alert alert-info">Nenhum registro.</div>
    {% endfor %}
  </div>

  <div class="list-group">
    <div class="list-group-item bg-light fw-bold">
      <div class="d-flex justify-content-between">
        <span>Total Geral</span>
      </div>
      <div class="d-flex justify-content-between small mt-1">
        <span>Valor Tabela</span>
        <span>{{ situacao.Total.valor|format_real }}</span>
      </div>
      <div class="d-flex justify-content-between small">
        <span>Unidades</span>
        <span>{{ situacao.Total.qtde }}</span>
      </div>
    </div>
  </div>
</div>




<hr class="my-5">
<div class="mx-3">
  <h3 class="mt-5">Resumo por Tipo</h3>

  {# ====== DESKTOP/TABLET: Tabela ====== #}
  <div class="d-none d-md-block">
    <table class="table table-bordered w-100">
      <thead class="table-light text-center">
        <tr>
          <th>Preço Médio Tipo</th>
          <th class="text-end">Qtde</th>
          <th class="text-start">Tipo</th>
          <th class="text-end">M² Priv</th>
          <th class="text-end">Valor de Tabela</th>
          <th class="text-end">R$ do M²</th>
        </tr>
      </thead>
      <tbody class="text-end">
        <tr>
          <td class="text-center"></td>
          <td>{{ resumo.qtde_lojas }}</td>
          <td class="text-start">Loja</td>
          <td>{{ resumo.priv_loja|floatformat:2|intcomma }}</td>
          <td>R$ {{ resumo.valor_loja|format_real }}</td>
          <td>R$ {{ resumo.m2_loja|floatformat:2|intcomma }}</td>
        </tr>

        <tr>
          <td class="text-center">{{ resumo.preco_medio_tipo|format_real }}</td>
          <td>{{ resumo.qtde_tipos }}</td>
          <td class="text-start">Tipo</td>
          <td>{{ resumo.priv_tipos|floatformat:2|intcomma }}</td>
          <td>R$ {{ resumo.valor_tipos|format_real}}</td>
          <td>R$ {{ resumo.m2_tipos|floatformat:2|intcomma }}</td>
        </tr>

        <tr class="fw-bold">
          <td></td>
          <td>{{ resumo.qtde_total }}</td>
          <td class="text-start">Total</td>
          <td>{{ resumo.priv_total|floatformat:2|intcomma }}</td>
          <td>R$ {{ resumo.valor_total|format_real }}</td>
          <td>R$ {{ resumo.m2_total|floatformat:2|intcomma }}</td>
        </tr>


        {% for item in resumo_lojas %}
        <tr>
          <td class="text-center">
            {% if item.preco_medio_tipo %}
            R$ {{ item.preco_medio_tipo|floatformat:2|intcomma }}
            {% endif %}
          </td>
          <td>{{ item.quantidade }}</td>
          <td class="text-start">{{ item.tipo }}</td>
          <td>{{ item.m2|floatformat:2|intcomma }}</td>
          <td>R$ {{ item.valor_venda|floatformat:2|intcomma }}</td>
          <td>R$ {{ item.valor_m2|floatformat:2|intcomma }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{# ====== CELULAR: Cartões ====== #}
<div class="d-block d-md-none">

  <div class="card mb-2">
    <div class="card-body py-2">
      <div class="d-flex justify-content-between align-items-baseline">
        <strong class="text-truncate">{{ item.tipo }}</strong>
      </div>
      <div class="row">
        <div class="col-6">Preço médio:</div>
        <div class="col-6">{{ resumo.preco_medio_tipo|format_real }}</div>
      </div>
      <hr>
      <div class="row fw-bold">
        <div class="col-6">{{resumo.qtde_lojas}}</div>
        <div class="col-6">Loja</div>
      </div>
      <div class="row">
        <div class="col-6">M² Priv</div>
        <div class="col-6">{{resumo.priv_loja|floatformat:2|intcomma }}</div>
      </div>
      <div class="row">
        <div class="col-6">Valor de Tabela</div>
        <div class="col-6">{{resumo.valor_loja|format_real }}</div>
      </div>
      <div class="row">
        <div class="col-6">Valor do M²</div>
        <div class="col-6">{{resumo.m2_loja|format_real }}</div>
      </div>
      <hr>
      <div class="row fw-bold">
        <div class="col-6">{{resumo.qtde_tipos}}</div>
        <div class="col-6">Tipos</div>
      </div>
      <div class="row">
        <div class="col-6">M² Priv</div>
        <div class="col-6">{{resumo.priv_tipos|floatformat:2|intcomma }}</div>
      </div>
      <div class="row">
        <div class="col-6">Valor de Tabela</div>
        <div class="col-6">{{resumo.valor_tipos|format_real }}</div>
      </div>
      <div class="row">
        <div class="col-6">Valor do M²</div>
        <div class="col-6">{{resumo.m2_tipos|format_real }}</div>
      </div>
      <hr>
      <div class="row fw-bold">
        <div class="col-6"></div>
        <div class="col-6">Total</div>
      </div>
      <div class="row">
        <div class="col-6">M² Priv</div>
        <div class="col-6">{{resumo.priv_total|floatformat:2|intcomma }}</div>
      </div>
      <div class="row">
        <div class="col-6">Valor de Tabela</div>
        <div class="col-6">{{resumo.valor_total|format_real }}</div>
      </div>
      <div class="row">
        <div class="col-6">Valor do M²</div>
        <div class="col-6">{{resumo.m2_total|format_real }}</div>
      </div>
      <hr>
    </div>
  </div>
</div>

{% endblock %}